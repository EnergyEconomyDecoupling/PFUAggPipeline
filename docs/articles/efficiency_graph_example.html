<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="PFUAggDatabase">
<title>Efficiency graph example • PFUAggDatabase</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Efficiency graph example">
<meta property="og:description" content="PFUAggDatabase">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">PFUAggDatabase</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/access_via_pins.html">Access PFU Database Products Via `Pins`</a>
    <a class="dropdown-item" href="../articles/efficiency_graph_example.html">Efficiency graph example</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Efficiency graph example</h1>
                        <h4 data-toc-skip class="author">Matthew Kuperus
Heun</h4>
            
            <h4 data-toc-skip class="date">2023-12-19</h4>
      
      
      <div class="d-none name"><code>efficiency_graph_example.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The MR-PFU Database contains primary, final, and useful energy and
exergy data for all countries covered by the International Energy Agency
(IEA). Aggregations are also available.</p>
<p>But it can be a challenge to get started with the MR-PFU Database if
you are unfamiliar with some types of <code>R</code> programming. This
vignette provides a detailed example of working with MR-PFU Database
information to help users get over that hurdle.</p>
<p>In particular, this vignette shows how to create a graph of
country-level energy and exergy efficiencies first presented at the
International Exergy Economics Workshop in July 2023 (IEEW2023) by
Matthew Kuperus Heun (Calvin University). In the process, important
concepts for accessing and working with the data are demonstrated,
including</p>
<ol style="list-style-type: decimal">
<li>creating a pinboard,</li>
<li>reading efficiency data,</li>
<li>preparing the data, including filtering,</li>
<li>creating an initial version of graph, and</li>
<li>refining the graph for presentation.</li>
</ol>
<p>Most <code>R</code> programs use packages that are loaded at the
beginning of a session. The following packages are used in this
vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">MKHthemes</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://energyeconomydecoupling.github.io/PFUSetup/" class="external-link">PFUSetup</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pins.rstudio.com/" class="external-link">pins</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readxl.tidyverse.org" class="external-link">readxl</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
<p>All packages are available on the Comprehensive R Archive Network
(CRAN), except <a href="https://github.com/MatthewHeun/MKHthemes/" class="external-link">MKHthemes</a> and <a href="https://github.com/EnergyEconomyDecoupling/PFUSetup/" class="external-link">PFUSetup</a>.
Instructions for loading <a href="https://github.com/MatthewHeun/MKHthemes/" class="external-link">MKHthemes</a> and <a href="https://github.com/EnergyEconomyDecoupling/PFUSetup/" class="external-link">PFUSetup</a>
are given below.</p>
</div>
<div class="section level2">
<h2 id="create-the-pinboard">Create the pinboard<a class="anchor" aria-label="anchor" href="#create-the-pinboard"></a>
</h2>
<p>The first step is to establish a “pinboard” for the <a href="https://pins.rstudio.com" class="external-link">pins</a> package. Someone from the
MR-PFU Database team will have shared the “PipelineReleases” folder if
you have access to IEA data. The <code>PFUSetup</code> package is
helpful to find the correct folder. Install the <code>PFUSetup</code>
package with the following code.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"EnergyEconomyDecoupling/PFUSetup"</span><span class="op">)</span></span></code></pre></div>
<p>Create the pinboard from the correct Dropbox folder. Your
<code>pinboard_folder</code> might be different from this example, due
to a different location on your computer.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pinboard_folder</span> <span class="op">&lt;-</span> <span class="fu">PFUSetup</span><span class="fu">::</span><span class="fu"><a href="https://energyeconomydecoupling.github.io/PFUSetup/reference/get_abs_paths.html" class="external-link">get_abs_paths</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"pipeline_releases_folder"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">pinboard_folder</span></span>
<span><span class="co">#&gt; [1] "/Users/mkh2/Dropbox/Fellowship 1960-2015 PFU database/OutputData/PipelineReleases"</span></span>
<span><span class="va">pinboard</span> <span class="op">&lt;-</span> <span class="fu">pins</span><span class="fu">::</span><span class="fu"><a href="https://pins.rstudio.com/reference/board_folder.html" class="external-link">board_folder</a></span><span class="op">(</span><span class="va">pinboard_folder</span>, versioned <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pinboard</span></span>
<span><span class="co">#&gt; Pin board <span style="color: #0000BB;">&lt;pins_board_folder&gt;</span></span></span>
<span><span class="co">#&gt; Path: '/Users/mkh2/Dropbox/Fellowship 1960-2015 PFU</span></span>
<span><span class="co">#&gt; database/OutputData/PipelineReleases'</span></span>
<span><span class="co">#&gt; Cache size: 0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="read-efficiency-data">Read efficiency data<a class="anchor" aria-label="anchor" href="#read-efficiency-data"></a>
</h2>
<p>Next, users can consult the <code>versions and products.xlsx</code>
file located in the “PipelineReleases” folder. to find the desired
database product. For this example, we want data for <code>pf</code>,
<code>fu</code>, and <code>pu</code> efficiencies, which can be found in
Product E, whose pin is named “agg_eta_pfu”. The “versions and
products.xlsx” file indicates that the pin version of the “agg_eta_pfu”
product for database v1.1 is “20230619T051304Z-f653c”. Putting it all
together, the following code reads the desired version of the desired
data for v1.1 of the PFU database.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agg_eta_pfu_data</span> <span class="op">&lt;-</span> <span class="fu">pins</span><span class="fu">::</span><span class="fu"><a href="https://pins.rstudio.com/reference/pin_read.html" class="external-link">pin_read</a></span><span class="op">(</span>board <span class="op">=</span> <span class="va">pinboard</span>,</span>
<span>                                   name <span class="op">=</span> <span class="st">"agg_eta_pfu"</span>,</span>
<span>                                   version <span class="op">=</span> <span class="st">"20230619T051304Z-f653c"</span><span class="op">)</span></span></code></pre></div>
<p><code>agg_eta_pfu_data</code> is an <code>R</code> data frame as
shown below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agg_eta_pfu_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 473,140 × 16</span></span></span>
<span><span class="co">#&gt;    Country Method Energy.type  Year IEAMW Chopped.mat Chopped.var</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AGO     PCM    E            <span style="text-decoration: underline;">1</span>971 IEA   None        None       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> AGO     PCM    E            <span style="text-decoration: underline;">1</span>971 IEA   None        None       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AGO     PCM    X            <span style="text-decoration: underline;">1</span>971 IEA   None        None       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> AGO     PCM    X            <span style="text-decoration: underline;">1</span>971 IEA   None        None       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> AGO     PCM    E            <span style="text-decoration: underline;">1</span>971 MW    None        None       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> AGO     PCM    E            <span style="text-decoration: underline;">1</span>971 MW    None        None       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AGO     PCM    X            <span style="text-decoration: underline;">1</span>971 MW    None        None       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> AGO     PCM    X            <span style="text-decoration: underline;">1</span>971 MW    None        None       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> AGO     PCM    E            <span style="text-decoration: underline;">1</span>971 Both  None        None       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AGO     PCM    E            <span style="text-decoration: underline;">1</span>971 Both  None        None       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 473,130 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more variables: Product.aggregation &lt;chr&gt;, Industry.aggregation &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   GrossNet &lt;chr&gt;, EX.p &lt;dbl&gt;, EX.f &lt;dbl&gt;, EX.u &lt;dbl&gt;, eta_pf &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   eta_fu &lt;dbl&gt;, eta_pu &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The columns have the following meanings:</p>
<ul>
<li>“Country” contains 3-letter country abbreviations.</li>
<li>“Method” contains only “PCM”, indicating that the “physical content
method” is used for all data.</li>
<li>“Energy.type” contains either “E” (for energy) or “X” (for
exergy).</li>
<li>“Year” is between 1960 and 2020, inclusive.</li>
<li>“IEAMW” contains one of “IEA” (IEA data),</li>
<li>“MW” (muscle work), or “Both” (for both IEA and muscle work
data).</li>
<li>“Chopped.mat” and “Chopped.var” are reserved for future use in the
database. In this object, both are always “None.”</li>
<li>“Product.aggregation” and “Industry.aggregation” tell how energy
carriers and industries are aggregated were aggregated prior to summing
to primary, final, and useful energy stages. For this example, primary,
final, and useful aggregations should be the same, regardless of the
value of</li>
<li>“Product.aggregation” or “Industry.aggregation.”</li>
<li>“GrossNet” contains either “Gross” or “Net” telling whether energy
industry own use is included in final and useful aggregations.</li>
<li>“EX.p”, “EX.f”, and “EX.u” contain primary, final, and useful stage
energy and exergy aggregations.</li>
<li>Finally, we come to the columns of interest for this graph. The
columns names “eta_pf”, “eta_fu”, and “eta_pu” contain primary-to-final,
final-to-useful, and primary-to-useful efficiencies.</li>
</ul>
</div>
<div class="section level2">
<h2 id="prepare-the-data-including-filtering">Prepare the data, including filtering<a class="anchor" aria-label="anchor" href="#prepare-the-data-including-filtering"></a>
</h2>
<p>In the code below, we prepare the data by filtering rows and
selecting columns of the <code>agg_eta_pfu_data</code> data frame to
focus on the data of interest for this graph. Comments in the code
narrate the process.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agg_eta_pfu_prepared</span> <span class="op">&lt;-</span> <span class="va">agg_eta_pfu_data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Select only those rows where we have both IEA and MW data, </span></span>
<span>  <span class="co"># where gross energy production is provided, and</span></span>
<span>  <span class="co"># where aggregations were calculated from fully specified data.</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">IEAMW</span> <span class="op">==</span> <span class="st">"Both"</span>,</span>
<span>                <span class="va">GrossNet</span> <span class="op">==</span> <span class="st">"Gross"</span>, </span>
<span>                <span class="va">Product.aggregation</span> <span class="op">==</span> <span class="st">"Specified"</span>,</span>
<span>                <span class="va">Industry.aggregation</span> <span class="op">==</span> <span class="st">"Specified"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Select only the columns of interest to us</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Country</span>, <span class="va">Energy.type</span>, <span class="va">Year</span>, <span class="va">eta_pf</span>, <span class="va">eta_fu</span>, <span class="va">eta_pu</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Pivot the data to create a value column</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">eta_pf</span>, <span class="va">eta_fu</span>, <span class="va">eta_pu</span><span class="op">)</span>,</span>
<span>                      names_to <span class="op">=</span> <span class="st">"Var.name"</span>,</span>
<span>                      values_to <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span></span>
<span><span class="co"># Here is the prepared data</span></span>
<span><span class="va">agg_eta_pfu_prepared</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 48,018 × 5</span></span></span>
<span><span class="co">#&gt;    Country Energy.type  Year Var.name  Value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AGO     E            <span style="text-decoration: underline;">1</span>971 eta_pf   0.713 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> AGO     E            <span style="text-decoration: underline;">1</span>971 eta_fu   0.238 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AGO     E            <span style="text-decoration: underline;">1</span>971 eta_pu   0.170 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> AGO     X            <span style="text-decoration: underline;">1</span>971 eta_pf   0.715 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> AGO     X            <span style="text-decoration: underline;">1</span>971 eta_fu   0.075<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> AGO     X            <span style="text-decoration: underline;">1</span>971 eta_pu   0.054<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AGO     E            <span style="text-decoration: underline;">1</span>972 eta_pf   0.729 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> AGO     E            <span style="text-decoration: underline;">1</span>972 eta_fu   0.240 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> AGO     E            <span style="text-decoration: underline;">1</span>972 eta_pu   0.175 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AGO     X            <span style="text-decoration: underline;">1</span>972 eta_pf   0.731 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 48,008 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-an-initial-version-of-graph">Create an initial version of graph<a class="anchor" aria-label="anchor" href="#create-an-initial-version-of-graph"></a>
</h2>
<p><code>agg_eta_pfu_prepared</code> is a data frame that contains
everything we need to make the graph. We use the <a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a> package to make the
graph.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agg_eta_pfu_prepared</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># Set the x and y axes</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>,</span>
<span>                                         y <span class="op">=</span> <span class="va">Value</span>,</span>
<span>                                         <span class="co"># Group by Country </span></span>
<span>                                         <span class="co"># to make individual lines</span></span>
<span>                                         <span class="co"># for each country</span></span>
<span>                                         group <span class="op">=</span> <span class="va">Country</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Create a line graph</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Put mini-graphs for energy type in rows and efficiency type in columns</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Energy.type</span><span class="op">)</span>,</span>
<span>                      cols <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Var.name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="efficiency_graph_example_files/figure-html/unnamed-chunk-7-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="refine-the-graph-with-colors-and-other-details">Refine the graph with colors and other details<a class="anchor" aria-label="anchor" href="#refine-the-graph-with-colors-and-other-details"></a>
</h2>
<p>The initial version of the graph provides confidence that we can use
the data, but it is not attractive.</p>
<ul>
<li>Line widths should be reduced so we can see individual countries
instead of an undifferentiated mass of lines for all countries.</li>
<li>Lines could be coloured by continent.</li>
<li>A world average line should be added and distinguished from other
lines.</li>
<li>The column labels (“eta_pf”, “eta_fu”, and “eta_pu”) should be
changed to Greek letters with subscripts (<span class="math inline">\(\eta_{pf}\)</span>, <span class="math inline">\(\eta_{fu}\)</span>, and <span class="math inline">\(\eta_{pu}\)</span>).</li>
<li>The left-to-right order of efficiencies should be changed to
“eta_pf”, “eta_fu”, “eta_pu”.</li>
<li>“E” and “X” on the rows of the graph should be changed to “Energy”
and “Exergy” for clarity.</li>
<li>Change “Asia_” to “Asia” in the “Country” and “Continent” column (to
be added later).</li>
<li>The word “Value” on the <span class="math inline">\(y\)</span>-axis
should be changed to they symbol for efficiency (<span class="math inline">\(\eta\)</span>).</li>
<li>There is no need for the word “Year” on the <span class="math inline">\(x\)</span>-axis. Everyone knows those are
years.</li>
<li>The year labels run into each other.</li>
<li>The gray background is ugly.</li>
</ul>
<p>Many of these changes are made by adjusting the values in the
metadata columns of the <code>agg_eta_pfu_prepared</code> data frame.
The code below shows those adjustments.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">agg_eta_pfu_nice</span> <span class="op">&lt;-</span> <span class="va">agg_eta_pfu_prepared</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># We use the string "Asia_" to indicate</span></span>
<span>    <span class="co"># our aggregation for Asia.</span></span>
<span>    <span class="co"># Change to "Asia" (without the trailing "_").</span></span>
<span>    Country <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">Country</span> <span class="op">==</span> <span class="st">"Asia_"</span> <span class="op">~</span> <span class="st">"Asia"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">Country</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Change "E" and "X" to "Energy" and "Exergy"</span></span>
<span>    Energy.type <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>      <span class="va">Energy.type</span>,</span>
<span>      <span class="st">"E"</span> <span class="op">~</span> <span class="st">"Energy"</span>,</span>
<span>      <span class="st">"X"</span> <span class="op">~</span> <span class="st">"Exergy"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    Var.name <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>      <span class="va">Var.name</span>,</span>
<span>      <span class="co"># Change names of efficiencies</span></span>
<span>      <span class="co"># for later subscripts of "pf", "fu", and "pu"</span></span>
<span>      <span class="st">"eta_pf"</span> <span class="op">~</span> <span class="st">"eta[pf]"</span>,</span>
<span>      <span class="st">"eta_fu"</span> <span class="op">~</span> <span class="st">"eta[fu]"</span>,</span>
<span>      <span class="st">"eta_pu"</span> <span class="op">~</span> <span class="st">"eta[pu]"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># Set ordering for efficiency variables</span></span>
<span>    <span class="co"># so they look nice in our graph</span></span>
<span>    Var.name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Var.name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eta[pf]"</span>, <span class="st">"eta[fu]"</span>, <span class="st">"eta[pu]"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>To further improve appearance, we can colour the individual country
lines by continent. And, we can highlight the world as a thick line atop
all countries.</p>
<p>The first step is to join continent information to the efficiency
data, thereby making continent data available for the graph. We can load
a data frame of countries and continents and join it to the efficiency
data frame.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The continents file is an input </span></span>
<span><span class="co"># to the calculation pipeline </span></span>
<span><span class="co"># that created the database.</span></span>
<span><span class="co"># Users can create their own </span></span>
<span><span class="co"># continent mapping data frame</span></span>
<span><span class="co"># or ask for ours.</span></span>
<span><span class="va">continents_file</span> <span class="op">&lt;-</span> <span class="fu">PFUSetup</span><span class="fu">::</span><span class="fu"><a href="https://energyeconomydecoupling.github.io/PFUSetup/reference/get_abs_paths.html" class="external-link">get_abs_paths</a></span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="st">"aggregation_mapping_path"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">continents_file</span></span>
<span><span class="co">#&gt; [1] "/Users/mkh2/Dropbox/Fellowship 1960-2015 PFU database/InputData/v1.2/aggregation_mapping.xlsx"</span></span>
<span><span class="va">continents_agg_map</span> <span class="op">&lt;-</span> <span class="va">continents_file</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Read the continent_aggregation tab of the Excel file</span></span>
<span>  <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html" class="external-link">read_excel</a></span><span class="op">(</span>sheet <span class="op">=</span> <span class="st">"continent_aggregation"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Adjust the column names</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    Country <span class="op">=</span> <span class="va">Many</span>,</span>
<span>    Continent <span class="op">=</span> <span class="va">Few</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Fix "Asia_" --&gt; "Asia"</span></span>
<span>    <span class="co"># to match the efficiency data frame.</span></span>
<span>    Continent <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">Continent</span> <span class="op">==</span> <span class="st">"Asia_"</span> <span class="op">~</span> <span class="st">"Asia"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">Continent</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">continents_agg_map</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 158 × 2</span></span></span>
<span><span class="co">#&gt;    Country Continent</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AGO     Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ALB     Europe   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ARE     MidEast  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ARG     SoCeAmr  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ARM     Asia     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> AUS     Oceania  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AUT     Europe   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> AZE     Asia     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> BEL     Europe   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> BEN     Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 148 more rows</span></span></span>
<span><span class="co"># Join to the efficiency data</span></span>
<span><span class="va">agg_eta_pfu_with_continents</span> <span class="op">&lt;-</span> <span class="va">agg_eta_pfu_nice</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">continents_agg_map</span>, by <span class="op">=</span> <span class="st">"Country"</span><span class="op">)</span></span>
<span><span class="co"># Notice the Continent column</span></span>
<span><span class="va">agg_eta_pfu_with_continents</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 48,018 × 6</span></span></span>
<span><span class="co">#&gt;    Country Energy.type  Year Var.name  Value Continent</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> AGO     Energy       <span style="text-decoration: underline;">1</span>971 eta[pf]  0.713  Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> AGO     Energy       <span style="text-decoration: underline;">1</span>971 eta[fu]  0.238  Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> AGO     Energy       <span style="text-decoration: underline;">1</span>971 eta[pu]  0.170  Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> AGO     Exergy       <span style="text-decoration: underline;">1</span>971 eta[pf]  0.715  Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> AGO     Exergy       <span style="text-decoration: underline;">1</span>971 eta[fu]  0.075<span style="text-decoration: underline;">6</span> Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> AGO     Exergy       <span style="text-decoration: underline;">1</span>971 eta[pu]  0.054<span style="text-decoration: underline;">1</span> Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> AGO     Energy       <span style="text-decoration: underline;">1</span>972 eta[pf]  0.729  Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> AGO     Energy       <span style="text-decoration: underline;">1</span>972 eta[fu]  0.240  Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> AGO     Energy       <span style="text-decoration: underline;">1</span>972 eta[pu]  0.175  Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> AGO     Exergy       <span style="text-decoration: underline;">1</span>972 eta[pf]  0.731  Africa   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 48,008 more rows</span></span></span></code></pre></div>
<p>Establish the continent colors.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">continent_colours</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>Africa <span class="op">=</span> <span class="st">"orange"</span>, Asia <span class="op">=</span> <span class="st">"gray"</span>,</span>
<span>                       Bunkers <span class="op">=</span> <span class="st">"darkgray"</span>, Europe <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>                       MidEast <span class="op">=</span> <span class="st">"cadetblue3"</span>,</span>
<span>                       NoAmr <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                       Oceania <span class="op">=</span> <span class="st">"blue"</span>, SoCeAmr <span class="op">=</span> <span class="st">"violet"</span>,</span>
<span>                       World <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p>To create a specific World-average line, we need to separate the
World data from all countries. Also, continent averages should be
removed from the data frame that contains country lines.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data frame of only World information</span></span>
<span><span class="co"># for years &gt;- 1971 </span></span>
<span><span class="co"># (the first year when all countries are in IEA data).</span></span>
<span><span class="co"># This data frame will be used to create the </span></span>
<span><span class="co"># World-average line</span></span>
<span><span class="va">agg_eta_pfu_world</span> <span class="op">&lt;-</span> <span class="va">agg_eta_pfu_with_continents</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"World"</span>, <span class="va">Year</span> <span class="op">&gt;=</span> <span class="fl">1971</span><span class="op">)</span></span>
<span><span class="co"># Create a data frame of countries only, </span></span>
<span><span class="co"># eliminating continent and world averages</span></span>
<span><span class="va">agg_eta_pfu_countries</span> <span class="op">&lt;-</span> <span class="va">agg_eta_pfu_with_continents</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">Country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Africa"</span>, <span class="st">"Asia"</span>, <span class="st">"Bunkers"</span>, <span class="st">"Europe"</span>, </span>
<span>                                 <span class="st">"MidEast"</span>, <span class="st">"NoAmr"</span>, <span class="st">"Oceania"</span>, <span class="st">"SoCeAmr"</span>, </span>
<span>                                 <span class="st">"World"</span>, <span class="st">"WRLD"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We will use the <a href="https://github.com/MatthewHeun/MKHthemes/" class="external-link">MKHthemes</a> package
to make nice-looking graphs with a white background and tick marks that
point inward, not outward. <a href="https://github.com/MatthewHeun/MKHthemes/" class="external-link">MKHthemes</a> can be
loaded with the following code.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"MatthewHeun/MKHthemes"</span><span class="op">)</span></span></code></pre></div>
<p>Now make the graph. Details different from the previous version are
identified by comments.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Year</span>,</span>
<span>                                       y <span class="op">=</span> <span class="va">Value</span>,</span>
<span>                                       group <span class="op">=</span> <span class="va">Country</span>, </span>
<span>                                       <span class="co"># Set country colours by continent</span></span>
<span>                                       colour <span class="op">=</span> <span class="va">Continent</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Create two different line layers.</span></span>
<span>  <span class="co"># The first has countries only and a narrow linewidth.</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">agg_eta_pfu_countries</span>,</span>
<span>                     linewidth <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># The second (upper) layer has World only, </span></span>
<span>  <span class="co"># a larger linewidth and black colour.</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">agg_eta_pfu_world</span>, </span>
<span>                     linewidth <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                     colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Set only a few years on the x-axis so the labels</span></span>
<span>  <span class="co"># don't collide</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1980</span>, <span class="fl">2000</span>, <span class="fl">2020</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Use the continent_colours for the lines</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">continent_colours</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Eliminate the x-axis label ("Year"); </span></span>
<span>  <span class="co"># everyone knows those are years.</span></span>
<span>  <span class="co"># Eliminate the colour label, "Continent";</span></span>
<span>  <span class="co"># everyone knows these are continent names.</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span>, </span>
<span>                colour <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Energy.type</span><span class="op">)</span>,</span>
<span>                      cols <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">Var.name</span><span class="op">)</span>,</span>
<span>                      labeller <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_parsed</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Set pleasant aesthetics such as white background, </span></span>
<span>  <span class="co"># gray border lines, and </span></span>
<span>  <span class="co"># inward-pointing tick marks.</span></span>
<span>  <span class="fu">MKHthemes</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MKHthemes/man/xy_theme.html" class="external-link">xy_theme</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    colour <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span></span>
<span>      <span class="co"># Adjust the size of the line segments in the legend</span></span>
<span>      <span class="co"># independent from linewidths in the graph itself</span></span>
<span>      override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="efficiency_graph_example_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The new version of the graph is aesthetically pleasing and conveys
more information than the initial attempt.</p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The PFU Database provides data to make graphs such as
primary-to-final, final-to-useful, and primary-to-useful efficiencies.
This vignette shows details of how to read and clean data, how to make
such graphs, and how to modify the graphs to be aesthetically
pleasing.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew Heun.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
